{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"all.js","sourcesContent":["const VERSION = 'v16.05.1'\n\nimport 'babel-polyfill';\nimport chalk from 'chalk';\nimport Table from 'cli-table';\nimport stream from 'stream';\nimport csv from 'csv';\nimport seedrandom from 'seedrandom';\n\nlet logging = true;\nconst log_ = (...args) => logging ? console.log(...args) : {};\nconst logTrue = (...args) => console.log(...args);\n\nlet prec = 6;\n\nlet rng = Math.random();\n\nfunction populate(...votes) {\n  let populated = [];\n  for (let vote of votes) {\n    Array(vote[0]).fill(vote[1]).forEach(v => populated.push(v));\n  }\n  return populated;\n}\n\nNumber.prototype.round = function(places) {\n  return +(Math.round(this + 'e+' + places)  + 'e-' + places);\n}\n\nfunction getValues(object) {\n  let values = new Array;\n  for (let prop in object) {\n    values.push(object[prop]);\n  }\n  return values;\n}\n\nfunction getMin(array) {\n  return array.reduce((a, b) => Math.min(a, b));\n}\n\nfunction pick(object, ...fields) {\n  let o = {};\n  for (let field of fields) {\n    Object.assign(o, {[field]: object[field]});\n  }\n\n  return o;\n}\n\nfunction removeBlanks(object) {\n  return pick(object,\n    ...Object.keys(object).filter(key => object[key] || object[key] === 0));\n}\n\nfunction withdraw(ballots, ...candidates) {\n  let votes = ballots.map(v => v.slice());\n  for (let candidate of candidates) {\n    votes.forEach((val, ind, arr) => {\n      votes[ind] = val.filter(v => v !== candidate);\n    });\n  }\n\n  return votes;\n}\n\nfunction countPref(pref, cand, votes) {\n  let count = 0;\n  votes.forEach((v, i, arr) => {\n    if (v[pref - 1] === cand) count++;\n  });\n  return count;\n}\n\nfunction getPref(pref, cand, votes) {\n  let count = [];\n  votes.forEach((v, i, arr) => {\n    if (v[pref - 1] === cand) count.push(i);\n  });\n  return count;\n}\n\nfunction round(votes, values, seats, quota, hopefuls, eliminated, elected,\n  counts, surplus = {}, ron = '') {\n  if (elected.length === seats) {\n    log_('<all vacancies filled>')\n    logTrue('********** COUNTING ENDS **********');\n    return {\n      elected,\n      counts,\n    }\n  }\n\n  if (hopefuls.length <= seats - elected.length) {\n    log_('<remaining candidates can fill all vacancies>')\n    hopefuls.forEach(v => {\n      elected.push(v);\n      log_(chalk.white.bgGreen('----- elected', v, '-----'));\n    });\n    logTrue('********** COUNTING ENDS **********');\n    return {\n      elected,\n      counts,\n    };\n  }\n\n  log_('########## ROUND', counts.length + 1, '##########');\n\n  let distributed = {};\n  if (Object.keys(surplus).length > 0) {\n    distributed = distributeSurplus(votes, values, counts[counts.length - 1],\n      surplus);\n    surplus = {};\n  }\n\n  let roundCount = {};\n  let roundElected = [];\n  let hasElected = false;\n\n  for (let v of hopefuls) {\n    let count = 0;\n    if (counts.length === 0) {\n      count = countPref(1, v, votes);\n    } else {\n      count = distributed[v];\n    }\n    roundCount[v] = count;\n    if (count >= quota) {\n      roundElected.push(v);\n      elected.push(v);\n      hopefuls = hopefuls.filter(h => h !== v);\n    }\n  }\n\n  counts.push(roundCount);\n  log_('+++++ round count +++++');\n  roundCountTable(roundCount);\n\n  let excluded = [...elected, ...eliminated];\n  if (roundElected.length === 0) {\n    let elimCand = eliminate(votes, values, '', roundCount, hopefuls, excluded,\n    surplus, counts, ron);\n    eliminated.push(elimCand);\n    hopefuls = hopefuls.filter(v => v !== elimCand);\n    log_(chalk.gray.bgYellow('----- eliminated', elimCand, '-----'));\n  } else {\n    roundElected.forEach(v => {\n      log_(chalk.white.bgGreen('----- elected', v, '-----'));\n      eliminate(votes, values, v, roundCount, hopefuls, excluded, surplus,\n        counts, ron, roundCount[v] - quota);\n    });\n  }\n\n  if (counts.length < 20) {} else {return;}\n  return round(votes, values, seats, quota, hopefuls, eliminated, elected,\n    counts, surplus, ron);\n}\n\nfunction countSurplus(votes, values, candidate, hopefuls, excluded) {\n  let surplus = {};\n  let transferred = votes.map((val, ind, arr) => {\n    if (val[0] === candidate) return val.slice();\n    return [];\n  });\n  let total = transferred.length;\n\n  for (let exclude of excluded) {\n    transferred.forEach((val, ind, arr) => {\n      transferred[ind] = val.filter(v => v !== exclude);\n    });\n  }\n\n  for (let hopeful of hopefuls) {\n    surplus[hopeful] = getPref(1, hopeful, transferred);\n  }\n\n  return {\n    dist: surplus,\n  };\n}\n\nfunction distributeSurplus(votes, values, lastCounts, surplus) {\n  let count = Object.assign({}, lastCounts);\n  let totalTransferred = {};\n  for (let candidate in surplus) {\n    if (surplus.hasOwnProperty(candidate)) {\n      totalTransferred = 0;\n      let tableCount = {};\n      let dist = surplus[candidate].dist;\n      if (surplus[candidate].surplus < count[candidate]) {\n        if (count[candidate] > 0) {\n          let value = surplus[candidate].surplus / count[candidate];\n          for (let transfer in dist) {\n            if (dist.hasOwnProperty(transfer)) {\n              for (let nextPref of dist[transfer]) {\n                values[nextPref] *= value;\n              }\n            }\n          }\n        }\n      }\n\n      log_(chalk.magenta('----- distributing surplus -----'));\n      for (let transfer in dist) {\n        if (dist.hasOwnProperty(transfer)) {\n          tableCount[transfer] = 0;\n          for (let nextPref of dist[transfer]) {\n            count[transfer] += values[nextPref];\n\n            tableCount[transfer] += values[nextPref];\n            totalTransferred += values[nextPref];\n          }\n          count[transfer] = count[transfer].round(prec);\n        }\n      }\n\n      log_(chalk.bold(candidate));\n      for (let transfer in tableCount) {\n        if (tableCount[transfer])\n          log_('- transfers', chalk.underline(tableCount[transfer]),\n            'vote(s) to', chalk.underline(transfer));\n      }\n\n      log_('-', chalk.bold('Transfer in total:'),\n        chalk.underline(totalTransferred), chalk.bold('Exhausted:'),\n        chalk.underline(surplus[candidate].surplus - totalTransferred));\n\n    }\n  }\n  return count;\n}\n\nfunction eliminate(votes, values, candidate, roundCount, hopefuls, excluded,\nsurplus, counts, ron, surplusVotes = null) {\n  if (candidate === '') {\n    candidate = Object.keys(roundCount).filter(v => v !== ron);\n    let minVotes = 0;\n    if (!ron) {\n      minVotes = getMin(getValues(roundCount));\n    } else {\n      let roundCount_ = Object.assign({}, roundCount);\n      if (roundCount_.hasOwnProperty(ron)) {\n        delete roundCount_[ron];\n      } else {\n        console.error(chalk.bold.red('***** RON candidate not found *****'));\n      }\n      minVotes = getMin(getValues(roundCount_));\n    }\n    let potentials = [];\n    candidate.forEach(function(val, ind) {\n      if (roundCount[val] === minVotes) {\n        potentials.push(ind);\n      }\n    });\n    if (potentials.length <= 0)\n      console.error(chalk.bold.red(\n        '********** unable to continue elimination **********'));\n    if (potentials.length === 1) {\n      candidate = candidate[potentials[0]];\n    } else {\n      let potentialCands = [];\n      for (let ind of potentials) {\n        potentialCands.push(candidate[ind])\n      }\n      candidate = breakTie(potentialCands, counts);\n    }\n    excluded.push(candidate);\n    hopefuls = hopefuls.filter(v => v !== candidate);\n  }\n\n  surplus[candidate] = countSurplus(votes, values, candidate, hopefuls,\n    excluded);\n  surplus[candidate].surplus = surplusVotes !== null ?\n    surplusVotes : roundCount[candidate];\n\n  votes.splice(0, votes.length, ...withdraw(votes, candidate));\n\n  return candidate;\n}\n\nfunction breakTie(potentials, counts) {\n  log_('*a tie!*');\n  if (counts.length > 1) {\n    let lastCount = counts[counts.length - 2];\n    let lastCounts = pick(lastCount, ...potentials);\n    let minVotes = getMin(getValues(lastCounts));\n    let potentialsTie = [];\n    potentials.forEach(function(val, ind) {\n      if (lastCounts[val] === minVotes) {\n        potentialsTie.push(ind);\n      }\n    });\n    if (potentialsTie.length <= 0)\n      console.error('********** unable to continue elimination **********');\n    if (potentialsTie.length === 1) {\n      let against = potentials[potentialsTie[0]];\n      log_('----- tie broken backwards against', against, ' -----');\n      return against;\n    }\n    let potentialCands = [];\n    for (let ind in potentialsTie) {\n      potentialCands.push(potentials[ind])\n    }\n    return breakTie(potentialCands, counts.slice(0, -1));\n  }\n\n  let against = potentials[Math.floor(rng() * potentials.length)];\n  log_('----- tie randomly broken against', against, '-----');\n  return against;\n}\n\nfunction roundCountTable(roundCount) {\n  let table = new Table();\n  for (let candidate in roundCount) {\n    table.push({\n      [chalk.cyan.bold(candidate)]: roundCount[candidate],\n    });\n  }\n  return log_(table.toString());\n}\n\nfunction countsTable(counts, elected) {\n  const isElected = candidate => elected.includes(candidate) ?\n    chalk.bold.green('Y') : chalk.bold.red('X');\n  let table = new Table({\n    head: [chalk.blue.bold('Round'), ...Array.from(new Array(counts.length),\n      (x, i) => chalk.blue.bold(i + 1)), chalk.bold.green('Elected'),],\n  });\n\n  for (let candidate in counts[0]) {\n    table.push({\n      [chalk.cyan.bold(candidate)]: [...Array.from(new Array(counts.length),\n        (x, i) => candidate in counts[i] ?\n          counts[i][candidate] : isElected(candidate)),\n        isElected(candidate),],\n    })\n  }\n\n  return log_(table.toString());\n}\n\nfunction getCandidates(votes) {\n  return [...new Set([].concat(...votes))];\n}\n\nexport function count({votes, candidates, withdrawn, seats, quota, log, ron,\ntitle, precision, seed, }) {\n  if (log === false) {\n    logging = false;\n  }\n\n  ron = ron || '';\n  title = title || '';\n  prec = precision || 6;\n\n  if (seed) {\n    rng = seedrandom(seed);\n  }\n\n  logTrue(chalk.underline('stvCount', VERSION, '(c) Z. Tong Zhang'));\n  logTrue(title);\n  logTrue('********** COUNTING STARTS **********')\n  if (withdrawn) {\n    votes = withdraw(votes, ...withdrawn);\n    log_(chalk.red('-----', ...withdrawn, 'withdrawn -----'));\n  }\n\n  candidates = candidates || getCandidates(votes);\n\n  if (quota < 0) quota = Math.floor(votes.length / (seats + 1) + 1);\n  let values = new Array(votes.length).fill(1);\n  let result = round(votes, values, seats, quota, candidates, [], [], [], {},\n    ron);\n\n  logTrue(chalk.bold(title));\n  log_('votes #:', votes.length);\n  log_('quota:', quota);\n  countsTable(result.counts, result.elected);\n\n  let elected = new Table({head: [chalk.bold.green('ELECTED')]});\n  result.elected.forEach(v => elected.push([v]));\n  log_(elected.toString());\n\n  return result;\n}\n\nexport function csvCount(csvData, options) {\n  let parser = csv.parse({columns: true}, (err, result) => {\n    if (err) console.error(err.message);\n    let votes = [];\n    let ind = 0;\n    for (let vote of result) {\n      vote = removeBlanks(vote);\n      let voteArray = Object.keys(vote).sort((a, b) => vote[a] - vote[b]);\n      let temp = [];\n      for (let i of voteArray)\n        i && temp.push(i);\n\n      voteArray = temp;\n      votes[ind++] = voteArray;\n    }\n    options.votes = votes;\n    count(options);\n  });\n\n  if (typeof csvData.resume === 'function') {\n    csvData.resume().pipe(parser);\n  } else if (typeof csv === 'string') {\n    converter.fromString(csvData);\n  } else {\n    return console.error('Error: CSV stream or string needed');\n  }\n}\n\nexport function bltCount(blt, options) {\n  let bltToOpt = (bltArray, opt) => {\n    opt.seats = bltArray[0][1];\n    opt.title = bltArray[-1][0] || '';\n    opt.candidates = [];\n    for (let i = -1 - bltArray[0][0]; i < -1; i++) {\n      opt.candidates.push(bltArray[i][0]);\n    }\n\n    let start = 1;\n    let votes = [];\n    if (bltArray[1][0] < 0) {\n      opt.withdrawn = bltArray[1];\n      start = 2;\n    }\n    for (let vote of bltArray.slice(start, -1 - bltArray[0][0])) {\n      if (vote.length > 1) {\n        let ranking = [];\n        vote.slice(1, -1).forEach(\n          candidate => ranking.push(opt.candidates[candidate - 1])\n        );\n        votes.push([vote[0], ranking]);\n      }\n    }\n\n    opt.votes = populate(...votes);\n    return count(opt);\n  }\n\n  let csvOpt = {\n    delimiter: ' ',\n    trim: true,\n  };\n  let parser = csv.parse(csvOpt, (err, result) => {\n    if (err) console.error(err.message);\n    bltToOpt(result, options);\n  });\n\n  if (typeof blt.resume === 'function') {\n    blt.resume().pipe(parser);\n  } else if (typeof blt === 'string') {\n    parser.write(blt);\n  } else {\n    return console.error('Error: BLT stream or string needed');\n  }\n}\n"],"sourceRoot":"/source/"}